upstream docker_pma{
	server 127.0.0.1:8002;
}

upstream docker_api{
	server 127.0.0.1:85;
}

upstream docker_panel{
	server 127.0.0.1:8004;
}


server {
    listen       80;
    #listen	443 	ssl;

    server_name  aveit.frc.utn.edu.ar;

    #ssl_certificate /etc/letsencrypt/live/aveit.frc.utn.edu.ar/cert.pem;
    #ssl_certificate_key /etc/letsencrypt/live/aveit.frc.utn.edu.ar/privkey.pem;
    #ssl_trusted_certificate /etc/letsencrypt/live/aveit.frc.utn.edu.ar/chain.pem;

    root   /usr/share/nginx/html/Pagina-web/sitio-aveit/dist/;
    index  index.html index.htm;

    server_tokens off;

    #add_header Strict-Transport-Security max-age=15768000;

    #ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    #ssl_prefer_server_ciphers on;
    #ssl_dhparam /etc/ssl/certs/dhparam.pem;
    #ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';
    #ssl_session_timeout 1d;
    #ssl_session_cache shared:SSL:50m;
    #ssl_stapling on;
    #ssl_stapling_verify on;


    location /panel/js {
     root /home/docker/containers/proyecto-carlos/svaveit/http_public/panel/js;
     try_files $uri $uri/ @apachesite;
     expires 1d;
     access_log /var/log/nginx/panel.js.access.log;
    } 

    location @apachesite {
     proxy_set_header X-Real-IP  $remote_addr;
     proxy_set_header Host $host;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     proxy_pass http://docker_panel;
    }
 
    location /panel {
     proxy_pass  http://docker_panel;
     proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
     proxy_redirect off;
     proxy_buffering off;
     proxy_set_header        Host            $host;
     proxy_set_header        X-Real-IP       $remote_addr;
     proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
     expires 1d;
     access_log /var/log/nginx/panel.access.log;
   }

    location /api {
     rewrite /api(.*) $1 break;
     proxy_pass  http://docker_api;
     proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
     proxy_redirect off;
     proxy_buffering off;
     proxy_set_header        Host            $host;
     proxy_set_header        X-Real-IP       $remote_addr;
     proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;

     access_log /var/log/nginx/api.access.log;
   }


    location /pma {
     rewrite /pma(.*) $1 break;
     proxy_pass  http://docker_pma;
     proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
     proxy_redirect off;
     proxy_buffering off;
     proxy_set_header        Host            $host;
     proxy_set_header        X-Real-IP       $remote_addr;
     proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;

     access_log /var/log/nginx/pma.access.log;
   }

   
   #location /wiki {
   #	alias /opt/paginas/Pagina-web/wiki;
   #	autoindex on;
   #}

    location /maraton {
        alias /opt/paginas/Pagina-web/maraton/2019;
        expires 5h;
        autoindex on;
    }

    location /cuna-de-emprendedores {
    	alias /opt/paginas/Pagina-web/cuna-de-emprendedores/2019;
	expires 5h;
        autoindex on;
    }

    location /.well-known {
     autoindex off;
     root /var/lib/aveit/letsencrypt;
    }

    location / {
        #alias /opt/paginas/Pagina-web/sitio-aveit/dist/;
	try_files $uri $uri/ /index.html;
        expires 14d;
        #autoindex on;
    }
}

